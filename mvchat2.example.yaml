# mvChat2 Server Configuration - Example
#
# Copy this file to mvchat2.yaml and configure all REQUIRED fields.
#
# IMPORTANT: All cryptographic keys MUST be unique for each deployment.
# Generate new keys with: openssl rand -base64 32
#
# For production deployments:
# 1. Set all keys via environment variables (recommended)
# 2. Enable SSL/TLS for database connections
# 3. Use strong passwords for all services

server:
  listen: ":6060"
  api_path: "/"
  static_mount: "/"
  static_path: "./static"
  use_x_forwarded_for: true
  default_country_code: "US"
  # HTTP server timeouts (seconds) - protects against slowloris attacks
  read_timeout: 15      # Max time to read request headers + body
  write_timeout: 15     # Max time to write response
  idle_timeout: 60      # Max time to wait for next request on keep-alive
  shutdown_timeout: 30  # Max time to wait for graceful shutdown
  # CORS allowed origins (REQUIRED for production!)
  # Use ["*"] for development only - allows all origins
  # For production, specify exact origins:
  # allowed_origins: ["https://app.example.com", "https://example.com"]
  # Supports wildcard subdomains: ["https://*.example.com"]
  allowed_origins: []

database:
  host: ${DB_HOST:localhost}
  port: 5432
  name: ${DB_NAME:mvchat2}
  user: ${DB_USER:postgres}
  password: ${DB_PASSWORD:}
  ssl_mode: disable  # Use 'require' or 'verify-full' in production
  max_open_conns: 50
  max_idle_conns: 50
  conn_max_lifetime: 60
  sql_timeout: 10
  # REQUIRED: Unique key for UID generation
  # Generate with: openssl rand -base64 16
  uid_key: ${UID_KEY:}
  # REQUIRED: Encryption key for data at rest (AES-256)
  # Generate with: openssl rand -base64 32
  encryption_key: ${ENCRYPTION_KEY:}

redis:
  enabled: ${REDIS_ENABLED:false}
  addr: ${REDIS_ADDR:localhost:6379}
  password: ${REDIS_PASSWORD:}
  db: ${REDIS_DB:0}
  node_id: ${NODE_ID:node1}

email:
  enabled: ${EMAIL_ENABLED:false}
  host: ${EMAIL_HOST:smtp.example.com}
  port: ${EMAIL_PORT:465}
  username: ${EMAIL_USERNAME:}
  password: ${EMAIL_PASSWORD:}
  from: ${EMAIL_FROM:noreply@example.com}
  from_name: ${EMAIL_FROM_NAME:mvChat}

auth:
  # REQUIRED: Salt for API key hashing
  # Generate with: openssl rand -base64 32
  api_key_salt: ${API_KEY_SALT:}

  basic:
    min_login_length: 4
    min_password_length: 8  # Recommend 8+ for production

  token:
    # REQUIRED: Secret key for JWT signing
    # Generate with: openssl rand -base64 32
    key: ${TOKEN_KEY:}
    expire_in: 1209600    # 2 weeks in seconds
    serial_number: 1

media:
  max_size: 8388608       # 8MB
  upload_dir: "./uploads"
  gc_period: 60
  gc_block_size: 100

limits:
  max_message_size: 131072      # 128KB
  max_subscriber_count: 128
  edit_window_minutes: 15
  unsend_window_minutes: 5
  max_edit_count: 10
  # Rate limiting (per session)
  rate_limit_messages: 30       # Max messages per second
  rate_limit_auth: 5            # Max auth attempts per minute
  rate_limit_upload: 10         # Max uploads per minute

debug:
  expvar_path: ""  # Disable in production (set empty string)
